<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#8338ec">
  <link rel="manifest" href="manifest.json">
  <title>CARDAPIO LUMIX ‚Ä¢ Card√°pio</title>
  <style>
    :root {
      --grad-1: #8338ec; --grad-2: #ff006e; --grad-3: #adff02; --bg: #0c0a09;
      --card: #1c1917; --text: #f2f2f2; --neon-fucsia: #ff006e; --neon-verde: #adff02;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; line-height: 1.5; }
    .hero { height: 70vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 0 20px; animation: fadeIn 1s ease-out; background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('background.png'); background-size: cover; background-position: center center; background-repeat: no-repeat; }
    .hero img.logo { width: 150px; height: 150px; border-radius: 50%; border: 4px solid var(--neon-verde); box-shadow: 0 0 20px var(--neon-verde), inset 0 0 10px var(--neon-verde); animation: pulse 2s infinite ease-in-out; }
    .hero h1 { font-size: 2.5em; font-weight: 800; margin: 20px 0 10px; text-shadow: 0 0 10px var(--bg); }
    .hero p { font-size: 1.1em; max-width: 500px; opacity: 0.9; text-shadow: 0 0 5px var(--bg); }
    .hero-info { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 30px; }
    .info-item { background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); border-radius: 20px; padding: 8px 15px; font-size: 0.9em; display: flex; align-items: center; gap: 8px; border: 1px solid #333; }
    .catalog-wrapper { padding: 0 20px 20px 20px; }
    .toolbar { display: flex; gap: 10px; margin: 20px 0; align-items: center; }
    #searchBar { flex-grow: 1; background-color: var(--card); border: 1px solid #333; color: var(--text); border-radius: 20px; padding: 12px 20px; font-size: 1em; }
    #notificationsBtn { background-color: var(--card); border: 1px solid #333; color: var(--text); border-radius: 50%; width: 45px; height: 45px; font-size: 1.5em; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; transition: color 0.2s; }
    #notificationsBtn.active { color: var(--neon-fucsia); }
    .category-filters { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
    .category-filters button { background: var(--card); color: var(--text); border: 1px solid #333; padding: 10px 20px; border-radius: 20px; cursor: pointer; transition: all 0.2s; }
    .category-filters button.active { background: var(--neon-fucsia); color: white; border-color: var(--neon-fucsia); font-weight: bold; }
    .catalog-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
    .category-title { color: var(--neon-verde); font-size: 1.8em; font-weight: bold; margin-top: 40px; margin-bottom: 20px; border-bottom: 2px solid var(--neon-fucsia); padding-bottom: 10px; }
    .product-row { display: flex; overflow-x: auto; gap: 15px; padding: 10px; margin: 0 -10px; scrollbar-width: thin; scrollbar-color: var(--neon-fucsia) var(--card); user-select: none; cursor: grab; }
    .product-row.active { cursor: grabbing; }
    .product-row::-webkit-scrollbar { height: 8px; } .product-row::-webkit-scrollbar-thumb { background-color: var(--neon-fucsia); border-radius: 4px; } .product-row::-webkit-scrollbar-track { background-color: var(--card); }
    .card { background-color: var(--card); border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; border: 1px solid #333; cursor: pointer; transition: transform 0.2s; width: 280px; flex-shrink: 0; }
    .card:hover { transform: translateY(-5px); }
    .card-img { height: 160px; width: 100%; object-fit: cover; pointer-events: none; }
    .card-body { padding: 15px; flex-grow: 1; }
    .card-title { font-size: 1.2em; font-weight: 600; margin: 0 0 5px; }
    .card-desc { font-size: 0.9em; opacity: 0.7; margin: 0 0 15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; }
    .card-footer { padding: 0 15px 15px; display: flex; justify-content: space-between; align-items: center; }
    .price { font-size: 1.3em; font-weight: 700; color: var(--neon-verde); }
    button { background: var(--neon-fucsia); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; text-shadow: 0 0 5px rgba(0,0,0,0.5); }
    button:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--neon-fucsia); }
    button:disabled { background: #555; cursor: not-allowed; }
    .cart-float { position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, var(--grad-1), var(--grad-2)); color: white; border-radius: 50%; width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; font-size: 1.5em; font-weight: 700; cursor: pointer; box-shadow: 0 5px 20px rgba(0,0,0,0.4); z-index: 1000; }
    .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); overflow-y: auto; }
    .modal-content { background: var(--bg); margin: 5% auto; padding: 25px; border: 1px solid var(--neon-fucsia); border-radius: 12px; max-width: 90%; width: 500px; box-shadow: 0 0 30px var(--neon-fucsia); animation: fadeIn 0.3s; }
    .cart-row { display: flex; flex-direction: column; padding: 10px 0; border-bottom: 1px solid #333; }
    .cart-row-main { display: flex; justify-content: space-between; align-items: center; }
    .cart-row-options { font-size: 0.8em; opacity: 0.7; margin-top: 5px; padding-left: 10px; border-left: 2px solid var(--neon-fucsia); }
    .ghost { background: transparent; border: 1px solid var(--neon-fucsia); color: var(--neon-fucsia); }
    .product-detail-modal-img { width: 100%; height: 250px; object-fit: cover; border-radius: 10px; margin-bottom: 20px; }
    .product-detail-modal-title { font-size: 2em; margin: 0; }
    .product-detail-modal-price { font-size: 1.5em; color: var(--neon-verde); margin: 10px 0; }
    .product-detail-modal-desc { opacity: 0.8; margin-bottom: 25px; }
    .options-form h3, .delivery-form h3 { color: var(--neon-verde); margin-top: 25px; margin-bottom: 10px; font-size: 1.1em; }
    .options-form .radio-group label, .delivery-form .radio-group label { display: flex; align-items: center; background-color: var(--card); padding: 15px; border-radius: 8px; margin-bottom: 10px; cursor: pointer; border: 2px solid #333; transition: border-color 0.2s; }
    .options-form .radio-group input:checked + label, .delivery-form .radio-group input:checked + label { border-color: var(--neon-fucsia); }
    .options-form .radio-group input, .delivery-form .radio-group input { display: none; }
    .delivery-form input[type="text"], .delivery-form input[type="tel"], .delivery-form textarea { width: 100%; background-color: var(--card); border: 1px solid #333; color: var(--text); border-radius: 8px; padding: 12px; margin-bottom: 15px; box-sizing: border-box; font-size: 1em; }
    .options-form textarea { width: 100%; background-color: var(--card); border: 1px solid #333; color: var(--text); border-radius: 8px; padding: 10px; min-height: 100px; /* --- AUMENTADO PARA MEJOR VISIBILIDAD EN M√ìVIL --- */ box-sizing: border-box; }
    #changeForContainer { display: none; }
    #locationStatus { font-size: 0.8em; opacity: 0.7; margin-top: 5px; }
  </style>
</head>
<body>
  <div class="hero">
    <img src="logo.png" alt="Logo de LUMIX ARTIFICIAL" class="logo">
    <h1>CARDAPIO LUMIX</h1>
    <p>Seu pedido na velocidade da luz. Explore nosso card√°pio interativo e pe√ßa agora.</p>
    <div class="hero-info">
      <span class="info-item">‚è∞ Tempo de Entrega: 25-45 min</span>
      <span class="info-item">üõµ Taxa de Entrega: Gr√°tis</span>
      <span class="info-item">üõçÔ∏è Pedido M√≠nimo: R$ 20,00</span>
    </div>
  </div>
  <div class="catalog-wrapper">
    <div class="toolbar">
      <input type="search" id="searchBar" placeholder="üîé Buscar no card√°pio..."><button id="notificationsBtn" title="Ativar notifica√ß√µes">üîî</button>
    </div>
    <div class="category-filters" id="categoryFilters"></div><div id="catalog"></div>
  </div>
  <div class="cart-float" id="openCart" style="display: none;"><span id="cartCount">0</span></div>
  <div class="modal" id="cartModal">
    <div class="modal-content">
      <h2>Seu Pedido</h2><div id="cartItems"></div><hr>
      <h3>Total: <span id="cartTotal">R$ 0,00</span></h3>
      <button id="checkoutBtn">Finalizar Pedido</button><button class="ghost" id="closeCart">Continuar Comprando</button>
    </div>
  </div>
  <div class="modal" id="productDetailModal"><div class="modal-content" id="productDetailContent"></div></div>
  
  <div class="modal" id="deliveryModal">
    <div class="modal-content">
      <h2>Informa√ß√µes de Entrega</h2>
      <form id="deliveryForm" class="delivery-form">
        <h3>Seus Dados</h3>
        <input type="text" id="customerName" placeholder="Nome completo" required>
        <input type="tel" id="customerPhone" placeholder="Telefone de contato (WhatsApp)" required>
        
        <h3>Endere√ßo</h3>
        <textarea id="customerAddress" placeholder="Rua, N√∫mero, Bairro, Ponto de Refer√™ncia..." rows="3" required></textarea>
        <button type="button" id="getLocationBtn" class="ghost">üìç Compartilhar Localiza√ß√£o (GPS)</button>
        <p id="locationStatus"></p>
        
        <h3>Forma de Pagamento</h3>
        <div class="radio-group">
            <input type="radio" id="payment_credit" name="payment" value="Cart√£o de Cr√©dito" checked><label for="payment_credit">Cart√£o de Cr√©dito (Maquininha)</label>
            <input type="radio" id="payment_debit" name="payment" value="Cart√£o de D√©bito"><label for="payment_debit">Cart√£o de D√©bito (Maquininha)</label>
            <input type="radio" id="payment_pix" name="payment" value="PIX"><label for="payment_pix">PIX (QR Code na Maquininha)</label>
            <input type="radio" id="payment_cash" name="payment" value="Dinheiro"><label for="payment_cash">Dinheiro</label>
        </div>

        <div id="changeForContainer">
            <h3>Precisa de troco? Para quanto?</h3>
            <input type="text" id="changeFor" placeholder="Ex: R$ 50,00">
        </div>
        
        <br>
        <button type="submit" id="confirmOrderBtn">Confirmar e Enviar Pedido</button>
        <button type="button" class="ghost" id="closeDeliveryModal">Cancelar</button>
      </form>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const catalog = document.getElementById('catalog');
        const categoryFilters = document.getElementById('categoryFilters');
        const productDetailModal = document.getElementById('productDetailModal');
        const productDetailContent = document.getElementById('productDetailContent');
        const cartFloat = document.getElementById('openCart');
        const cartCount = document.getElementById('cartCount');
        const cartModal = document.getElementById('cartModal');
        const cartItems = document.getElementById('cartItems');
        const cartTotal = document.getElementById('cartTotal');
        const openCart = document.getElementById('openCart');
        const closeCart = document.getElementById('closeCart');
        const searchBar = document.getElementById('searchBar');
        const notificationsBtn = document.getElementById('notificationsBtn');
        const deliveryModal = document.getElementById('deliveryModal');
        const checkoutBtn = document.getElementById('checkoutBtn');
        const closeDeliveryModal = document.getElementById('closeDeliveryModal');
        const deliveryForm = document.getElementById('deliveryForm');
        const getLocationBtn = document.getElementById('getLocationBtn');
        const locationStatus = document.getElementById('locationStatus');
        const changeForContainer = document.getElementById('changeForContainer');
        let cart = [];
        const money = val => val.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

        const products = [
            {id: 1, name: 'Picanha na Chapa', price: 89.90, desc: 'Picanha fatiada com mandioca cozida na manteiga de garrafa e vinagrete.', category: 'Pratos', img: 'images/1.png', options: { protein: ['Carne Bovina', 'Carne de Sol'], cutlery: true }}, {id: 4, name: 'Strogonoff', price: 45.50, desc: 'Cremoso strogonoff com cogumelos, acompanha arroz branco e batata palha.', category: 'Pratos', img: 'images/4.png', options: { protein: ['Frango', 'Fil√© Mignon'], cutlery: true }}, {id: 2, name: 'Feijoada Completa', price: 59.90, desc: 'Acompanha arroz, couve, farofa, torresmo e laranja. Servida √†s quartas e s√°bados.', category: 'Pratos', img: 'images/2.png'}, {id: 3, name: 'Moqueca de Peixe', price: 79.90, desc: 'Deliciosa moqueca com peixe branco, piment√µes, tomate, leite de coco e azeite de dend√™. Acompanha arroz e pir√£o.', category: 'Pratos', img: 'images/3.png', options: { cutlery: true }}, {id: 5, name: 'Parmegiana de Mignon', price: 65.00, desc: 'Bife de fil√© mignon √† parmegiana com muito queijo, acompanha arroz e fritas.', category: 'Pratos', img: 'images/5.png', options: { cutlery: true }}, {id: 24, name: 'Bai√£o de Dois', price: 52.00, desc: 'Prato nordestino com arroz, feij√£o fradinho, carne seca, queijo coalho e cheiro-verde.', category: 'Pratos', img: 'images/24.png'}, {id: 25, name: 'Lasanha √† Bolonhesa', price: 48.00, desc: 'Generosa por√ß√£o de lasanha com massa fresca, molho bolonhesa e queijo mussarela gratinado.', category: 'Pratos', img: 'images/25.png', options: { cutlery: true }}, {id: 26, name: 'Salm√£o Grelhado', price: 75.00, desc: 'Posta de salm√£o grelhado ao molho de maracuj√°, acompanha arroz com br√≥colis e legumes.', category: 'Pratos', img: 'images/26.png', options: { cutlery: true }}, {id: 6, name: 'Fritas com Cheddar e Bacon', price: 35.90, desc: 'Por√ß√£o generosa de batatas fritas crocantes com cheddar cremoso e bacon em cubos.', category: 'Por√ß√µes', img: 'images/6.png'}, {id: 7, name: 'An√©is de Cebola', price: 29.90, desc: 'An√©is de cebola empanados e crocantes, acompanha molho barbecue da casa.', category: 'Por√ß√µes', img: 'images/7.png'}, {id: 27, name: 'Dadinho de Tapioca', price: 32.00, desc: 'Cubinhos de tapioca com queijo coalho, acompanha geleia de pimenta.', category: 'Por√ß√µes', img: 'images/27.png'}, {id: 28, name: 'Torresmo de Rolo', price: 45.00, desc: 'Pancetta de porco pururucada, crocante por fora e macia por dentro. Acompanha lim√£o.', category: 'Por√ß√µes', img: 'images/28.png'}, {id: 29, name: 'Bolinho de Bacalhau', price: 38.00, desc: 'Por√ß√£o com 10 unidades do cl√°ssico bolinho de bacalhau portugu√™s.', category: 'Por√ß√µes', img: 'images/29.png'}, {id: 30, name: 'T√°bua de Frios', price: 68.00, desc: 'Sele√ß√£o de queijos, salames, presunto de parma, azeitonas e p√£es.', category: 'Por√ß√µes', img: 'images/30.png'}, {id: 9, name: 'Iscas de Til√°pia', price: 42.00, desc: 'Tirinhas de til√°pia empanadas e fritas, perfeitas para petiscar. Acompanha molho t√°rtaro.', category: 'Por√ß√µes', img: 'images/9.png'}, {id: 10, name: 'Past√©is Mistos', price: 32.00, desc: 'Por√ß√£o com 8 past√©is: Carne Seca com Catupiry e Queijo.', category: 'Por√ß√µes', img: 'images/10.png'}, {id: 11, name: 'Pudim de Leite', price: 15.00, desc: 'Cl√°ssico pudim de leite condensado com calda de caramelo, cremoso e irresist√≠vel.', category: 'Sobremesas', img: 'images/11.png'}, {id: 12, name: 'Mousse de Maracuj√°', price: 18.00, desc: 'Mousse aerado com o azedinho e doce na medida certa, com calda de maracuj√° fresco.', category: 'Sobremesas', img: 'images/12.png'}, {id: 13, name: 'A√ßa√≠ na Tigela (500ml)', price: 25.00, desc: 'A√ßa√≠ batido com banana, acompanha granola, leite em p√≥ e leite condensado.', category: 'Sobremesas', img: 'images/13.png'}, {id: 14, name: 'Petit Gateau', price: 22.90, desc: 'Bolinho quente de chocolate com interior cremoso, servido com sorvete de creme e calda.', category: 'Sobremesas', img: 'images/14.png'}, {id: 15, name: 'Torta Holandesa', price: 19.90, desc: 'Fatia de torta com base de biscoito, creme holand√™s e cobertura de chocolate.', category: 'Sobremesas', img: 'images/15.png'}, {id: 31, name: 'Cheesecake de Frutas Vermelhas', price: 24.00, desc: 'Fatia da famosa torta de queijo com uma generosa calda de frutas vermelhas.', category: 'Sobremesas', img: 'images/31.png'}, {id: 32, name: 'Salada de Frutas', price: 16.00, desc: 'Mix de frutas da esta√ß√£o: mam√£o, mel√£o, morango, uva e manga.', category: 'Sobremesas', img: 'images/32.png'}, {id: 16, name: 'Caipirinha de Lim√£o', price: 18.00, desc: 'A tradicional caipirinha brasileira, feita com cacha√ßa de qualidade, lim√£o e a√ß√∫car.', category: 'Bebidas', img: 'images/16.png'}, {id: 17, name: 'Guaran√° Antarctica (Lata)', price: 7.00, desc: 'O refrigerante com o sabor original do Brasil.', category: 'Bebidas', img: 'images/17.png'}, {id: 18, name: '√Ågua de Coco (500ml)', price: 9.00, desc: '√Ågua de coco natural e gelada, direto da fruta.', category: 'Bebidas', img: 'images/18.png'}, {id: 19, name: 'Suco de Laranja Natural (500ml)', price: 10.00, desc: 'Feito com laranjas frescas espremidas na hora.', category: 'Bebidas', img: 'images/19.png'}, {id: 20, name: 'Cerveja Long Neck', price: 12.00, desc: 'Escolha entre Heineken, Budweiser ou Stella Artois.', category: 'Bebidas', img: 'images/20.png'}, {id: 33, name: 'Coca-Cola (Lata)', price: 7.00, desc: 'Coca-Cola original, gelada e refrescante.', category: 'Bebidas', img: 'images/33.png'}, {id: 34, name: 'Caf√© Espresso', price: 6.00, desc: 'Caf√© forte e encorpado para finalizar sua refei√ß√£o.', category: 'Bebidas', img: 'images/34.png'}];
        
        function renderCategories() { const categories = ['Todos', ...new Set(products.map(p => p.category).filter(c => c))]; categoryFilters.innerHTML = ''; categories.forEach(category => { const btn = document.createElement('button'); btn.dataset.category = category.toLowerCase(); btn.textContent = category; categoryFilters.appendChild(btn); }); }
        function renderCatalog(searchTerm = '', categoryFilter = 'todos') { catalog.innerHTML = ''; const searchLower = searchTerm.toLowerCase(); const filteredProducts = products.filter(p => { const matchesCategory = categoryFilter === 'todos' || (p.category && p.category.toLowerCase() === categoryFilter); const matchesSearch = p.name.toLowerCase().includes(searchLower) || p.desc.toLowerCase().includes(searchLower); return matchesCategory && matchesSearch; }); if (categoryFilter === 'todos' && searchTerm === '') { const categories = [...new Set(products.map(p => p.category).filter(c => c))]; categories.forEach(category => { catalog.innerHTML += `<h2 class="category-title">${category}</h2>`; const productRow = document.createElement('div'); productRow.className = 'product-row'; products.filter(p => p.category === category).forEach(p => { productRow.appendChild(createProductCard(p)); }); catalog.appendChild(productRow); }); } else { const catalogGrid = document.createElement('div'); catalogGrid.className = 'catalog-grid'; filteredProducts.forEach(p => { catalogGrid.appendChild(createProductCard(p)); }); catalog.appendChild(catalogGrid); } addCardEventListeners(); addDragScrollToRows(); }
        function createProductCard(p) { const el = document.createElement('div'); el.className = 'card'; el.dataset.details = p.id; el.innerHTML = `<img src="${p.img}" alt="${p.name}" class="card-img"><div class="card-body"><h3 class="card-title">${p.name}</h3><p class="card-desc">${p.desc}</p></div><div class="card-footer"><span class="price">${money(p.price)}</span><button class="ghost">Ver Detalhes</button></div>`; return el; }
        
        function showProductDetail(id) {
            const p = products.find(x => x.id == id);
            let optionsHtml = '<form id="productOptionsForm" class="options-form">'; // Inicia el formulario para todos
            
            if (p.options) {
                if (p.options.protein) {
                    optionsHtml += '<h3>Escolha a Prote√≠na</h3><div class="radio-group">';
                    p.options.protein.forEach((item, index) => {
                        optionsHtml += `<input type="radio" id="protein_${index}" name="protein" value="${item}" ${index === 0 ? 'checked' : ''}><label for="protein_${index}">${item}</label>`;
                    });
                    optionsHtml += '</div>';
                }
                if (p.options.cutlery) {
                    optionsHtml += '<h3>Precisa de talheres?</h3><div class="radio-group">';
                    optionsHtml += `<input type="radio" id="cutlery_yes" name="cutlery" value="Sim" checked><label for="cutlery_yes">Sim</label><input type="radio" id="cutlery_no" name="cutlery" value="N√£o"><label for="cutlery_no">N√£o</label>`;
                    optionsHtml += '</div>';
                }
            }

            // El campo de observaciones se a√±ade siempre, dentro del formulario
            optionsHtml += '<h3>Observa√ß√µes</h3><textarea id="observations" placeholder="Ex: tirar a cebola, ponto da carne, etc."></textarea>';
            optionsHtml += '</form>';
            
            productDetailContent.innerHTML = `
                <img src="${p.img}" alt="${p.name}" class="product-detail-modal-img"><h2 class="product-detail-modal-title">${p.name}</h2>
                <p class="product-detail-modal-price">${money(p.price)}</p><p class="product-detail-modal-desc">${p.desc}</p>
                ${optionsHtml} <br><button id="addToCartFromDetail">Adicionar ao Carrinho</button><button class="ghost" id="closeDetailModal">Voltar</button>`;
            productDetailModal.style.display = 'block';
            document.getElementById('addToCartFromDetail').addEventListener('click', () => {
                const selectedOptions = {};
                const form = document.getElementById('productOptionsForm');
                // El formulario siempre existir√°, as√≠ que no es necesario el 'if (form)'
                const protein = form.querySelector('input[name="protein"]:checked'); if (protein) selectedOptions.protein = protein.value;
                const cutlery = form.querySelector('input[name="cutlery"]:checked'); if (cutlery) selectedOptions.cutlery = cutlery.value;
                const obs = form.querySelector('#observations'); if (obs && obs.value.trim() !== '') selectedOptions.observa√ß√µes = obs.value.trim();
                addToCart(id, selectedOptions);
                productDetailModal.style.display = 'none';
            });
            document.getElementById('closeDetailModal').addEventListener('click', () => { productDetailModal.style.display = 'none'; });
        }

        function addCardEventListeners() { document.querySelectorAll('[data-details]').forEach(card => { let isDragging = false; card.addEventListener('mousedown', () => { isDragging = false; }); card.addEventListener('mousemove', () => { isDragging = true; }); card.addEventListener('mouseup', e => { if (isDragging) return; const id = +e.currentTarget.dataset.details; showProductDetail(id); }); }); }
        function addDragScrollToRows() { const sliders = document.querySelectorAll('.product-row'); sliders.forEach(slider => { let isDown = false; let startX; let scrollLeft; slider.addEventListener('mousedown', (e) => { isDown = true; slider.classList.add('active'); startX = e.pageX - slider.offsetLeft; scrollLeft = slider.scrollLeft; }); slider.addEventListener('mouseleave', () => { isDown = false; slider.classList.remove('active'); }); slider.addEventListener('mouseup', () => { isDown = false; slider.classList.remove('active'); }); slider.addEventListener('mousemove', (e) => { if (!isDown) return; e.preventDefault(); const x = e.pageX - slider.offsetLeft; const walk = (x - startX) * 2; slider.scrollLeft = scrollLeft - walk; }); }); }
        function addToCart(productId, options = {}) { const product = products.find(p => p.id === productId); const optionsKey = JSON.stringify(options); const existingItem = cart.find(item => item.productId === productId && JSON.stringify(item.options) === optionsKey); if (existingItem) { existingItem.quantity++; } else { cart.push({ cartItemId: Date.now().toString(), productId, quantity: 1, options, name: product.name, price: product.price }); } updateCartUI(); }
        function removeFromCart(cartItemId) { const itemIndex = cart.findIndex(item => item.cartItemId === cartItemId); if (itemIndex > -1) { cart[itemIndex].quantity--; if (cart[itemIndex].quantity <= 0) cart.splice(itemIndex, 1); } updateCartUI(); }
        function updateCartUI() { const totalCount = cart.reduce((sum, item) => sum + item.quantity, 0); const totalValue = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0); cartFloat.style.display = totalCount > 0 ? 'flex' : 'none'; cartCount.textContent = totalCount; cartTotal.textContent = money(totalValue); cartItems.innerHTML = ''; cart.forEach(item => { let optionsText = Object.entries(item.options).map(([key, value]) => `<strong>${key.charAt(0).toUpperCase() + key.slice(1)}:</strong> ${value}`).join('<br>'); const row = document.createElement('div'); row.className = 'cart-row'; row.innerHTML = `<div class="cart-row-main"><span>${item.name} x ${item.quantity}</span><span>${money(item.price * item.quantity)} <button class='ghost' data-rem='${item.cartItemId}'>-</button></span></div>${optionsText ? `<div class="cart-row-options">${optionsText}</div>` : ''}`; cartItems.appendChild(row); }); document.querySelectorAll('[data-rem]').forEach(b => b.addEventListener('click', e => { removeFromCart(e.currentTarget.dataset.rem); })); localStorage.setItem('lumixCart', JSON.stringify(cart)); }
        function loadCart() { const savedCart = localStorage.getItem('lumixCart'); if (savedCart) { try { cart = JSON.parse(savedCart) || []; } catch (e) { cart = []; } } }
        function setupEventListeners() {
            categoryFilters.addEventListener('click', e => { if (e.target.tagName === 'BUTTON') { const selectedCategory = e.target.dataset.category; categoryFilters.querySelectorAll('button').forEach(btn => btn.classList.remove('active')); e.target.classList.add('active'); renderCatalog(searchBar.value, selectedCategory); } });
            searchBar.addEventListener('input', () => { const activeBtn = categoryFilters.querySelector('button.active'); renderCatalog(searchBar.value, activeBtn ? activeBtn.dataset.category : 'todos'); });
            openCart.addEventListener('click', () => { cartModal.style.display = 'block'; });
            closeCart.addEventListener('click', () => { cartModal.style.display = 'none'; });
            productDetailModal.addEventListener('click', e => { if (e.target === productDetailModal) productDetailModal.style.display = 'none'; });
            checkoutBtn.addEventListener('click', () => { cartModal.style.display = 'none'; deliveryModal.style.display = 'block'; });
            closeDeliveryModal.addEventListener('click', () => { deliveryModal.style.display = 'none'; });
            deliveryForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const phone = '+5562999998888';
                let lines = ['*Novo Pedido via Card√°pio LUMIX!* ü§ñ\n\n--- *ITENS DO PEDIDO* ---\n'];
                cart.forEach(item => { lines.push(`- ${item.quantity}x ${item.name}`); let optionsText = Object.entries(item.options).map(([key, value]) => `  - ${key.charAt(0).toUpperCase() + key.slice(1)}: ${value}`).join('\n'); if (optionsText) lines.push(optionsText); });
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                lines.push(`\n*Total do Pedido: ${money(total)}*`);
                lines.push('\n--- *DADOS DE ENTREGA* ---');
                lines.push(`*Nome:* ${document.getElementById('customerName').value}`);
                lines.push(`*Telefone:* ${document.getElementById('customerPhone').value}`);
                lines.push(`*Endere√ßo:* ${document.getElementById('customerAddress').value}`);
                if (locationStatus.textContent.includes('http')) { lines.push(`*Localiza√ß√£o GPS:* ${locationStatus.textContent}`); }
                lines.push('\n--- *PAGAMENTO* ---');
                const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
                lines.push(`*Forma de Pagamento:* ${paymentMethod}`);
                if (paymentMethod === 'Dinheiro') {
                    const change = document.getElementById('changeFor').value;
                    if (change) lines.push(`*Levar troco para:* R$ ${change}`);
                }
                const text = encodeURIComponent(lines.join('\n'));
                window.open('https://wa.me/' + phone.replace(/\+/g, '') + '?text=' + text, '_blank');
            });
            document.querySelectorAll('input[name="payment"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    changeForContainer.style.display = e.target.value === 'Dinheiro' ? 'block' : 'none';
                });
            });
            getLocationBtn.addEventListener('click', () => {
                if ('geolocation' in navigator) {
                    locationStatus.textContent = 'Obtendo localiza√ß√£o...';
                    getLocationBtn.disabled = true;
                    navigator.geolocation.getCurrentPosition(position => {
                        const { latitude, longitude } = position.coords;
                        const mapsLink = `https://maps.google.com/?q=${latitude},${longitude}`;
                        locationStatus.textContent = mapsLink;
                        getLocationBtn.disabled = false;
                    }, error => {
                        locationStatus.textContent = 'N√£o foi poss√≠vel obter a localiza√ß√£o. Verifique as permiss√µes.';
                        getLocationBtn.disabled = false;
                    });
                } else {
                    locationStatus.textContent = 'Geolocaliza√ß√£o n√£o √© suportada neste navegador.';
                }
            });
            notificationsBtn.addEventListener('click', () => { Notification.requestPermission().then(permission => { if (permission === 'granted') { notificationsBtn.classList.add('active'); new Notification('CARDAPIO LUMIX', { body: 'Pronto! Agora voc√™ receber√° nossas novidades e promo√ß√µes.', icon: 'logo.png' }); } }); });
        }
        function registerServiceWorker() { if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js').catch(err => console.error('Falha ao registrar Service Worker:', err)); } }
        function init() { loadCart(); renderCategories(); renderCatalog(); updateCartUI(); setupEventListeners(); registerServiceWorker(); const firstCategoryButton = categoryFilters.querySelector('button'); if(firstCategoryButton) firstCategoryButton.classList.add('active'); }
        init();
    });
  </script>
</body>
</html>
